<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ”® Alzar â€” Robot Companion</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"/>
  <!-- Leaflet map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOP BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header class="topbar">
  <div class="topbar-left">
    <span class="logo">ğŸ”® ALZAR</span>
    <span class="tagline">Travel Companion</span>
  </div>
  <div class="topbar-center">
    <div class="status-pill" id="connection-pill">
      <span class="dot" id="connection-dot"></span>
      <span id="connection-label">Connectingâ€¦</span>
    </div>
  </div>
  <div class="topbar-right">
    <div class="stat-block">
      <span class="stat-label">Robot ğŸ”‹</span>
      <span class="stat-value" id="battery-robot">â€”%</span>
    </div>
    <div class="stat-block">
      <span class="stat-label">Drone ğŸ”‹</span>
      <span class="stat-value" id="battery-drone">â€”%</span>
    </div>
    <div class="stat-block">
      <span class="stat-label">Mode</span>
      <span class="stat-value" id="mode-label">â€”</span>
    </div>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN GRID â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main class="grid">

  <!-- CAMERA PANEL -->
  <section class="panel panel-camera">
    <div class="panel-header">
      <h2>Camera Feed</h2>
      <div class="cam-toggle">
        <button class="btn btn-sm active" id="btn-cam-ground" onclick="setCamera('ground')">Ground</button>
        <button class="btn btn-sm" id="btn-cam-drone" onclick="setCamera('drone')">Drone</button>
      </div>
    </div>
    <div class="camera-view" id="camera-view">
      <img id="camera-stream" src="/video_feed" alt="Camera Feed"
           onerror="showCameraPlaceholder()"
           style="width:100%;height:100%;object-fit:cover;display:none;"/>
      <div class="camera-placeholder" id="camera-placeholder">
        <div class="cam-icon">ğŸ“·</div>
        <p>Awaiting camera connectionâ€¦</p>
        <p class="cam-sub">Connect the Raspberry Pi camera to enable live feed</p>
      </div>
    </div>
  </section>

  <!-- MAP PANEL -->
  <section class="panel panel-map">
    <div class="panel-header">
      <h2>Map</h2>
      <span class="gps-status" id="gps-status">ğŸ“¡ GPS acquiringâ€¦</span>
    </div>
    <div id="map"></div>
  </section>

  <!-- COMMENTARY PANEL -->
  <section class="panel panel-commentary">
    <div class="panel-header">
      <h2>Commentary</h2>
      <span class="commentary-count" id="commentary-count">0 entries</span>
    </div>
    <div class="commentary-log" id="commentary-log">
      <div class="commentary-empty">Alzar will start talking once connectedâ€¦</div>
    </div>
    <div class="commentary-input">
      <input type="text" id="question-input" placeholder="Ask Alzar somethingâ€¦" onkeydown="handleQuestionKey(event)"/>
      <button class="btn btn-ask" onclick="askQuestion()">Ask</button>
    </div>
  </section>

  <!-- CONTROLS PANEL -->
  <section class="panel panel-controls">
    <div class="panel-header">
      <h2>Controls</h2>
    </div>

    <!-- Mode selector -->
    <div class="control-group">
      <label class="control-label">Talk Mode</label>
      <div class="mode-buttons">
        <button class="btn mode-btn" id="mode-quiet" onclick="setMode('quiet')">ğŸ¤« Quiet</button>
        <button class="btn mode-btn" id="mode-normal" onclick="setMode('normal')">ğŸ’¬ Normal</button>
        <button class="btn mode-btn active" id="mode-talkative" onclick="setMode('talkative')">ğŸ™ï¸ Talkative</button>
      </div>
    </div>

    <!-- Movement pad -->
    <div class="control-group">
      <label class="control-label">Movement</label>
      <div class="dpad">
        <button class="btn dpad-btn dpad-up"    onmousedown="move('forward')"  onmouseup="move(null)">â–²</button>
        <button class="btn dpad-btn dpad-left"  onmousedown="move('left')"     onmouseup="move(null)">â—€</button>
        <button class="btn dpad-btn dpad-stop"  onclick="move(null)">â– </button>
        <button class="btn dpad-btn dpad-right" onmousedown="move('right')"    onmouseup="move(null)">â–¶</button>
        <button class="btn dpad-btn dpad-down"  onmousedown="move('backward')" onmouseup="move(null)">â–¼</button>
      </div>
    </div>

    <!-- Voice controls -->
    <div class="control-group">
      <label class="control-label">Voice</label>
      <div class="voice-row">
        <button class="btn mode-btn active" id="btn-tts-on"  onclick="setTTS(true)">ğŸ”Š On</button>
        <button class="btn mode-btn"        id="btn-tts-off" onclick="setTTS(false)">ğŸ”‡ Off</button>
        <button class="btn btn-sm" onclick="testVoice()" style="flex:1">Test Voice</button>
      </div>
    </div>

    <!-- Drone controls -->
    <div class="control-group">
      <label class="control-label">Drone</label>
      <div class="drone-status-row">
        <span class="drone-badge" id="drone-badge">ğŸš Docked</span>
        <span class="drone-battery" id="drone-battery-label">â€”%</span>
      </div>
      <div class="drone-buttons">
        <button class="btn btn-launch" id="btn-launch" onclick="droneLaunch()">ğŸš€ Launch</button>
        <button class="btn btn-return" id="btn-return" onclick="droneReturn()" disabled>â†© Return</button>
      </div>
    </div>
  </section>

</main>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCRIPTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
